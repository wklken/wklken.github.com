<!DOCTYPE html>
<html lang="en">

<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
    <meta name="google-site-verification" content="SzE6WCs23qFevgBzRIuG9vcfLU0lW_Vd5hFT-cJOLBE" />
    <title>Python 代码规范小结</title>
    <meta charset="utf-8" />
    <meta name="description" content="">
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link rel="shortcut icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="/theme/css/styles.css" media="all" />
        <link rel="stylesheet" href="/theme/css/monokai.css" media="all" />
        <link rel="stylesheet" href="/theme/css/tab.min.css" media="all" />
        <link rel="stylesheet" href="/theme/css/jquery-ui.min.css" media="all" />

        <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
        <!--
        <link rel="stylesheet" href="http://apps.bdimg.com/libs/fontawesome/4.2.0/css/font-awesome.min.css">
        -->
        <!--[if IE 7]>
            <link rel="stylesheet" href="/theme/css/font-awesome-ie7.min.css">
        <![endif]-->

        <link href="/" type="application/atom+xml" rel="alternate" title="wklken's blog ATOM Feed" />
        <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="wklken's blog RSS Feed" />

</head>

<body>
    <div id="page" class="row">
        <div class="large-9 large-centered columns">

        <header id="header">
            <div class="constraint">
                <div class="o">
                    <a href="/"><h1 class="banner">Wklken <span class="blue"> Building </span></h1></a>

                <div class="social">
                            <a href="https://github.com/wklken" target='_blank'><i class="icon-github-sign icon-2x"></i></a>
                            <a href="http://weibo.com/wklken" target='_blank'><i class="icon-weibo icon-2x"></i></a>
                            <a href="mailto:wklken@yeah.net"><i class="icon-envelope icon-2x"></i></a>
                            <a href="http://www.wklken.me/feed.xml" target='_blank'><i class="icon-rss-sign icon-2x"></i></a>
                </div>
                <div class="nav">
                            <a href="/">首页</a>
                            <a href="/categories.html">分类</a>
                            <a href="/archives.html">归档</a>
                            <a href="/pages/projects.html">项目</a>
                            <a href="/pages/links.html">友链</a>
                            <a href="/pages/aboutme.html">关于</a>

                </div>

                </div>
            </div>
        </header><!-- /#banner -->

        <section id="main">


<article id="article">
    <section id="header">
        <!--
        <div class="meta">2016年11月03日</div>
        <h1 id="title"> Python 代码规范小结 </h1>
        -->
        <div class="meta"> &nbsp; </div>
        <h1> Python 代码规范小结 </h1>
    </section>

        <section id="toc">
            <div id="toc"><ul><li><a class="toc-href" href="#" title="Python 代码规范小结">Python 代码规范小结</a><ul><li><a class="toc-href" href="#law" title="law">law</a></li><li><a class="toc-href" href="#ji-chu-feng-ge" title="基础: 风格">基础: 风格</a></li><li><a class="toc-href" href="#zhu-shi" title="注释">注释</a></li><li><a class="toc-href" href="#ming-ming" title="命名">命名</a></li><li><a class="toc-href" href="#chang-liang" title="常量">常量</a></li><li><a class="toc-href" href="#bian-liang" title="变量">变量</a></li><li><a class="toc-href" href="#shu-ju-jie-gou" title="数据结构">数据结构</a></li><li><a class="toc-href" href="#biao-da-shi" title="表达式">表达式</a></li><li><a class="toc-href" href="#kong-zhi-liu-fen-zhi" title="控制流: 分支">控制流: 分支</a></li><li><a class="toc-href" href="#kong-zhi-liu-xun-huan" title="控制流: 循环">控制流: 循环</a></li><li><a class="toc-href" href="#kong-zhi-liu-yi-chang-chu-li" title="控制流: 异常处理">控制流: 异常处理</a></li><li><a class="toc-href" href="#han-shu" title="函数">函数</a></li><li><a class="toc-href" href="#lei" title="类">类</a></li><li><a class="toc-href" href="#mo-kuai" title="模块">模块</a></li><li><a class="toc-href" href="#chou-xiang" title="抽象">抽象</a></li><li><a class="toc-href" href="#she-ji" title="设计">设计</a></li><li><a class="toc-href" href="#qi-ta" title="其他">其他</a></li><li><a class="toc-href" href="#can-kao-shu-mu" title="参考书目">参考书目</a></li></ul></li></ul></div>
        </section>
    <section id="content">
        <hr/>
<p>code review中一些小结, 还没来得及加例子, 简要记录, 供参考</p>
<h2 id="law">law</h2>
<blockquote>
<p>一: 一切都与复杂度有关
二: 代码应当易于理解</p>
</blockquote>
<p>对人:</p>
<blockquote>
<p>"好程序员”应当竭尽全力, 把程序写得让其他程序员(以及以后的自己)容易理解.</p>
</blockquote>
<p>对代码:</p>
<blockquote>
<ol>
<li>代码被阅读的次数远多于编写和修改的次数</li>
<li>E = mc2 (Error = more codes)</li>
</ol>
</blockquote>
<p>对项目:</p>
<blockquote>
<p>公式: 可行性=(当前价值+未来价值)/(实现成本+维护成本). 即相比降低实现成本, 降低维护成本更加重要</p>
</blockquote>
<h2 id="ji-chu-feng-ge">基础: 风格</h2>
<blockquote>
<p>团队成员遵守统一的风格, 保持风格的一致性, 减少理解难度</p>
</blockquote>
<p>遵循基础的编码风格:</p>
<p>请仔细阅读, 使用对应编辑器插件工具协助检查</p>
<ul>
<li>
<p>遵循  <a href="https://www.python.org/dev/peps/pep-0008/">pep8</a> 风格
利用pep8工具(编辑器相关插件)来解决这个问题, 在review之前处理. 以避免在review过程中出现此类问题.</p>
</li>
<li>
<p>遵循 <a href="https://google.github.io/styleguide/pyguide.html">Google Code Style</a> / <a href="http://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/">中文版</a></p>
</li>
<li>
<p>不要吝啬空行, 把相关的代码行分组, 形成代码块. 声明按块组织起来, 并且把代码分成”段落”(按步骤/顺序/逻辑结构分), 排版合理</p>
</li>
<li>每行只写一个语句, 每行只声明一个变量</li>
</ul>
<h2 id="zhu-shi">注释</h2>
<blockquote>
<p>注释应该有很高的<code>价值</code>(传递信息/空间占用)</p>
</blockquote>
<ul>
<li>代码本身应该尽力做到自说明</li>
<li>注释, 记录了在写代码过程中的思考, 保持紧凑, 简单准确的描述</li>
<li>
<p>不要使用尾注释. 容易被整行拷贝/不容易被编辑修改/逐渐腐烂</p>
<div class="monokai"><pre><span></span>x = 1  # bad comment

# good comment
x = 1
</pre></div>
</li>
<li>
<p>不需要的代码, 维护到版本库后(写明<code>commit info</code>), 然后删除. 不要注释起来</p>
</li>
<li>不要给不好的命名加注释, 应该去修改命名</li>
<li>不要给那些从代码本身就能<code>快速</code>推断出来的事实写注释.(不要为了注释而注释)</li>
<li>对于复杂的计算逻辑, 要给出注释, 可以通过列举例子, 简单的输入输出来描述</li>
<li>对于大段的逻辑或模块, 需要给总结性注释</li>
<li>注释代码时, 应注重-为何做, 而不是-怎么做</li>
<li>每行注释前用一个空行分开. 注释缩进要和相应代码一致</li>
</ul>
<h2 id="ming-ming">命名</h2>
<blockquote>
<p>把信息装入名字中.(自说明)</p>
</blockquote>
<ul>
<li>尽量短, 但是要包含足够的信息(刨掉其中毫无意义的词)</li>
<li>命名一定要有意义, 尽量少使用单个字符作为命名, 除非短表达式(列表解析/lambda等)以及小的作用域范围</li>
<li>常量大写, 变量小写, 类名驼峰, 函数名小写加下划线, 不要混用下划线和驼峰.</li>
<li>不要使用关键字命名, 例如<code>type</code> 和 <code>dir</code></li>
<li>避免使用容易混淆的命名, 防歧义</li>
<li>慎用首字母缩略词和缩写, 除非团队成员都理解(不要妄图用注释来解决这个问题, 即, 不要注释不好的命名)</li>
<li>不要使用大小写来区分不同对象</li>
<li>同一个变量, 在多个地方, 前后端/数据库/不同函数/请求等, 尽量保持命名一致性</li>
<li>不要害怕过长的命名, 保证易于理解和阅读(现代编辑器可以搞定自动补全和批量变更的问题)</li>
<li>使用具体的名字, 而不是泛化的名字, 例如<code>params/args</code>等, 没有隐含任何信息</li>
<li><code>bool</code>类型, 除非名字本身有<code>True/False</code>的含义, 否则建议统一使用<code>is_</code>前缀</li>
<li>不要使用双重否定的命名: <code>is_not_pass</code></li>
<li><code>for a in b</code>, 注意 <code>a</code> 和 <code>b</code> 的单复数区分</li>
</ul>
<h2 id="chang-liang">常量</h2>
<ul>
<li>常量大写</li>
<li>作用于同一个模块/逻辑的多个常量, 建议使用统一的前缀</li>
<li>将常量统一组织到某个文件/某几个文件, 并写明注释.</li>
<li>函数/循环中的正则, 请预先<code>compile</code>, 放入变量中.</li>
<li>善用<code>Enum</code>, 对可读性提升很大</li>
<li>同一个枚举变量中, 其包含类型应当一致</li>
</ul>
<h2 id="bian-liang">变量</h2>
<ul>
<li>减少变量: 变量越多, 越难全部追踪其动向. a.减少没有价值的中间变量 b.减少中间结果(可以通过<code>提前返回</code>来消除) c.减少控制流变量</li>
<li>缩小变量作用域: 避免全局变量(命名空间污染). 需要做到让你的变量对尽量少的代码行可见.</li>
<li>变量定义尽量靠近其使用的地方, 或者, 在使用时定义.</li>
<li>不要使用<code>import *</code>, 会出现各种<code>突如其来</code>的变量名, 可能导致名字空间污染, 造成诡异问题</li>
</ul>
<h2 id="shu-ju-jie-gou">数据结构</h2>
<ul>
<li><code>dict</code>, 不要使用<code>for key in d.keys()</code>, 直接使用<code>for key in d</code></li>
</ul>
<h2 id="biao-da-shi">表达式</h2>
<blockquote>
<p>原则: 保持简短, 易懂.(拆分超长表达式)</p>
</blockquote>
<ul>
<li>抽取反复出现的长表达式到变量或者函数调用</li>
<li>使用解释变量, 将超长表达式中的自表达式抽取城一个解释变量.(抽取, 然后使用变量, 而不是每次都重复表达式)</li>
<li>总结变量: 一个表达式不需要解释, 但是装入一个新的变量中仍然有用. 短名字替代一大块代码. 例如: <code>numbers[0]['obj'].name</code></li>
<li>使用摩根定理: <code>not a and not b</code> to <code>not (a or b)</code></li>
<li>删除公共子表达式：如果发现某个表达式老是在你面前出现，就把它赋值给一个变量</li>
<li>中文, 请统一使用<code>u"中文"</code></li>
<li>表达式中避免使用<code>魔数</code>, 使用常量/枚举替代之</li>
</ul>
<h2 id="kong-zhi-liu-fen-zhi">控制流: 分支</h2>
<ul>
<li><code>if/else</code>顺序: a. 先处理正逻辑而不是负逻辑. b. 先处理掉简单的情况, 还能保证if/else在同一个屏幕内都可见(否则到了<code>else</code>需要回头查) c.先处理有趣或可疑的逻辑</li>
<li><code>return early</code>, 从函数中提前返回. 使用<code>guard clause</code>来实现. 某些情况返回后, 将不必要思考某个分支出口, 剩余注意力集中在为数不多的情况. 另一个好处是, 能有效减少代码缩进.</li>
<li>减少嵌套: 嵌套很深的代码很难理解, 每个嵌套层次会在读者’思维栈’上又增加了一个条件. 使用<code>return early</code>来减少嵌套. 而循环中的减少嵌套方式, 可以使用<code>if condition: continue/break</code>来进行<code>提早返回</code>.</li>
<li>减少嵌套: 当你对代码进行改动的时候, 从全新的角度审视它, 把它作为一个整体来看待.只关心局部, 不敢动旧有代码, 很容易一层层逻辑嵌套往里加导致深层嵌套</li>
<li>使用<code>is</code>来判定是否是<code>None</code>, 而不是<code>==</code></li>
<li>条件语句中参数顺序: 左侧变量, 右侧字面值/常量</li>
<li>默认情况都使用<code>if...else</code>, 三目运算只有在最简单的情况下才使用</li>
<li><code>if condition: return</code> 则不需要<code>else</code></li>
<li>注意<code>if/else</code>的多层嵌套, 在某些情况下, 判断条件中恒真/恒假的情况</li>
</ul>
<h2 id="kong-zhi-liu-xun-huan">控制流: 循环</h2>
<ul>
<li>善用<code>enumerate</code>而不是维护<code>index</code>变量( <code>enumerate</code> 还可以从1开始计数)</li>
<li>除非必要(逻辑确实如此且带<code>break</code>), 否则不要使用<code>for...else</code>.(增加理解成本)</li>
<li>不要使用<code>for _ in l: _.x</code>, 可读性太差</li>
<li>减少循环内的<code>if...else...</code>嵌套层次, 可以使用<code>if condition: continue</code></li>
</ul>
<h2 id="kong-zhi-liu-yi-chang-chu-li">控制流: 异常处理</h2>
<blockquote>
<p>异常日志同注释, 应该有很高的<code>价值</code>(传递信息/空间占用)</p>
</blockquote>
<ul>
<li>不要把所有代码放到<code>try except</code>中, 只捕获会出异常的代码片段. 注意粒度, 不要放入不必要的代码</li>
<li>不要吞掉异常, 处理或抛出, 同时要打日志(使用<code>logging</code>而不是<code>print</code>打日志)</li>
<li>谨慎使用<code>except Exception</code>捕获所有异常.</li>
<li>不要在<code>finally</code>语句中使用return进行返回, 有坑.</li>
<li>异常的错误信息要<code>有用</code>, 即足够明确, 对问题排查有帮助.</li>
<li>不要使用异常控制程序的流程. 滥用异常, 异常不应该处理正常逻辑</li>
<li>不要滥用异常, 底层被调用函数早已<code>try...except</code>处理了, 调用方不需要再次处理</li>
</ul>
<h2 id="han-shu">函数</h2>
<blockquote>
<p>函数不要太大, 嵌套不要太深</p>
</blockquote>
<ul>
<li>参数命名的一致性: 多个参数, 选择一个有意义的顺序, 并始终一致地使用它(可读性更好, 更容易发现问题)</li>
<li>不要使用可变对象作为函数默认参数的值</li>
<li><strong>一次只做一件事</strong>, 注意函数大小, 注意抽象/拆分</li>
<li>抽取不相关的子问题到独立的函数中, 例如纯工具代码, 通用代码, 项目专属代码</li>
<li>抽取反复出现重复的代码到独立函数中</li>
<li><code>return</code> 值不要使用<code>0/1</code>来代表<code>True/False</code></li>
<li>同一个函数可能存在多个<code>return</code>, 返回值要保持一致(个数/类型)</li>
<li><code>return early</code>, 减少阅读代码时的逻辑堆积, 减少贯穿函数始终用于最终判断return的变量数量. 超过3个就变得有些难以维护了, 阅读过程中确定其值有困难</li>
<li>如果函数调用链中, 参数或者return的值反复出现pack/unpack, 可以考虑用<code>dict</code>封装来进行传递.</li>
<li>如果发现每次调用一个函数后, 还需要对返回值进行二次处理, 则是函数封装得不够导致的. 需重构函数, 将处理加进去. (防止某次调用忘了二次处理导致的bug)</li>
</ul>
<h2 id="lei">类</h2>
<ul>
<li>不要使用type进行类型检查, 用<code>isinstance</code></li>
<li>使用新式类, 驼峰命名</li>
<li>假设类的某个属性, 每次取出来都需要进行处理(格式化, 转换等, 例如日期格式), 使用<code>property</code>封装这层处理, 同时处理异常情况.</li>
</ul>
<h2 id="mo-kuai">模块</h2>
<ul>
<li><code>import</code>顺序: 标准库/第三方库/本项目, 之间使用空行隔开</li>
<li>多行<code>import</code>, 请使用<code>from a import (b, c, d)</code>而不是<code>\</code>来进行换行</li>
<li>不要使用<code>from A import *</code></li>
<li>当相对独立的多个逻辑代码混杂放在一起, 或者发现constant文件超大包含了大量不同逻辑的产量, 可以考虑模块切分</li>
</ul>
<h2 id="chou-xiang">抽象</h2>
<ul>
<li>一定不要机械地复制粘贴代码(会出现大量的重复代码), 应该从全局考虑是否可以抽象</li>
<li>多个函数之间, 如果仅有一两行代码不同, 则可以进行抽象提取</li>
<li>当一段相似的代码出现两次以上, 需要考虑封装(注意粒度)</li>
</ul>
<h2 id="she-ji">设计</h2>
<blockquote>
<p>软件设计三大误区: 1.编写不必要的代码 2.代码难以修改 3.过分追求通用</p>
</blockquote>
<ul>
<li>思考足够充分, 减少过度设计</li>
</ul>
<h2 id="qi-ta">其他</h2>
<ul>
<li>熟悉标准库, 减少土制轮子的概率, 可以少写代码</li>
<li>熟悉框架/优秀第三方库提供的接口及特性, 原因同上</li>
<li>项目发布前, 移除所有<code>print</code>语句</li>
<li>文件/函数是否写明作者信息? 不, 版本记录中有作者信息. 容易形成<code>领地</code>, 他人不敢修改/不敢大改, 容易造成代码腐烂. 占用空间且没啥用.</li>
</ul>
<h2 id="can-kao-shu-mu">参考书目</h2>
<ul>
<li>编写可读代码的艺术</li>
<li>简约之美—软件设计之道</li>
<li>编写高质量代码—改善Python程序的91个建议</li>
</ul>
    </section>

    <section id="copyright">
        <div class="copyright">
            版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" >Creative Commons BY-NC-ND 3.0</a>
        </div>

        <div class="donation">
            <center>
                <div style="width: 70%;">
                    <img src="/imgs/life/donation_w.png" style=""/>
                    <strong>
                        <div style="text-align:center;">
                            如果我的文章或项目对你有所帮助, 可以扫码进行小额捐赠<br>
                            如果有主机需求, 可点下方vultr进入注册, 带小尾巴:)<br>
                            如果要加广告位, 请邮件联系<br>
                        </ol>
                    </strong>
                </div>
            </center>

        </div>
    </section>


    <section id="neighbors">
        <div>
                        <a class="left" href="http://www.wklken.me/posts/2016/07/24/about-vim.html">
                            上一篇:  [分享]关于vim
                        </a>
                        <a class="right" href="http://www.wklken.me/posts/2016/12/03/refactoring-01.html">
                            下一篇: 读书笔记-重构: 章6 重新组织函数
                        </a>
        </div>
    </section>

    <section id="ad">
        <!-- <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
        <!-- [> blog_ad_003 <] -->
        <!-- <ins class="adsbygoogle" -->
            <!-- style="display:block" -->
            <!-- data-ad-client="ca-pub-7635941258020589" -->
            <!-- data-ad-slot="7030416955" -->
            <!-- data-ad-format="auto"></ins> -->
        <!-- <script> -->
        <!-- (adsbygoogle = window.adsbygoogle || []).push({}); -->
        <!-- </script> -->

        <a href="https://www.vultr.com/?ref=7825696-4F"><img src="https://www.vultr.com/media/banner_1.png" width="728" height="90"></a>
        <a href='http://www.vultr.com/?ref=6847203' target="_blank">
        <img src="/imgs/ads/vultr.png"> </img>
        </a>
    </section>



<section id="comments">
        <div class="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_identifier = "posts/2016/11/03/python-code-style.html";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://wklken.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            </div>
</section>



</article>
        </section><!--end #main-->

            <footer class="row">
                <div class="large-12 columns">
                    <p>
                            Copyright © 2015 wklken <br>
                            Hosted on <a href="http://www.vultr.com/?ref=6954153-3B"> vultr </a>. Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>.
                            <!-- Hosted on <a href="http://www.vultr.com/?ref=6847203"> vultr </a> Also <a href="https://www.digitalocean.com/?refcode=8ee73f2c47ce"> DigitalOcean </a>. Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>. -->
                    </p>
                </div>
            </footer>

            </div>
        </div>

        <section id="extras" class="body">
        </section><!-- /#extras -->



<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/jquery-scrollUp/2.1.0/jquery.scrollUp.min.js"></script>
<script src="http://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
<script>
    $(function(){
        $.scrollUp({
              scrollText: '', // Text for element, can contain HTML
            });
    });
</script>


<script type="text/javascript">
  /* var Swiftype = window.Swiftype || {}; */
  /* Swiftype.searchSearchFields = { */
    /* "page": ["title^10", "body"] */
  /* }; */

  /* (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){ */
  /* (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t); */
  /* e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e); */
  /* })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st'); */

  /* _st('install','v6K-_DamCeHvwX6z3o2F'); */
</script>



    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-42275748-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>




<div id="share">
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":["mshare","tsina","weixin","douban","meilishuo","mogujie","youdao","sdo","mail","twi","copy","print"],"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"5","bdPos":"right","bdTop":"96.5"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</div>



<script  src="http://www.wklken.me/theme/js/scroll-header.js" type="text/javascript"></script>




</body>
</html>